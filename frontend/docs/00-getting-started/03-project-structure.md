# Project Structure

This document explains the frontend monorepo structure to help you navigate the codebase.

## Monorepo Overview

The frontend uses pnpm workspaces with multiple packages:

```
frontend/
├── packages/
│   ├── data-portal/          # Main web application
│   ├── eslint-config/        # Shared ESLint configuration
│   ├── eslint-plugin/        # Custom ESLint rules
│   └── neuroglancer/         # 3D tomogram viewer
├── docs/                     # Developer documentation
├── package.json              # Root workspace config
├── pnpm-workspace.yaml       # Workspace package list
├── .nvmrc                    # Node.js version
└── .prettierrc.yml           # Code formatting rules
```

## Packages

| Package | Purpose |
|---------|---------|
| `data-portal` | Remix/React application - the main CryoET Data Portal |
| `eslint-config` | Shared ESLint rules used across packages |
| `eslint-plugin` | Project-specific custom ESLint rules |
| `neuroglancer` | 3D viewer integration for visualizing tomograms |

## data-portal Application Structure

The main application lives in `packages/data-portal/`:

```
data-portal/
├── app/                      # Application source code
├── public/                   # Static assets
├── e2e/                      # Playwright E2E tests
├── package.json              # Dependencies and scripts
├── remix.config.js           # Remix framework config
├── tailwind.config.ts        # Tailwind CSS customization
├── codegen.ts                # GraphQL code generation
├── tsconfig.json             # TypeScript configuration
└── jest.config.cjs           # Unit test configuration
```

## app/ Directory

The core application code organized by concern:

| Directory | Purpose |
|-----------|---------|
| `__generated_v2__/` | **Auto-generated GraphQL types - DO NOT EDIT** |
| `apiNormalization/` | Data normalization utilities for transforming API responses |
| `components/` | React components organized by feature |
| `constants/` | Application constants and configuration values |
| `context/` | React context providers |
| `graphql/` | GraphQL queries (`.server.ts` files for server-side fetching) |
| `hooks/` | Custom React hooks |
| `mocks/` | Test mocks (LocalStorage, Remix) for unit testing |
| `queries/` | Query hooks for data fetching |
| `routes/` | Remix routes - pages and API endpoints (file-based routing) |
| `state/` | Jotai atoms for global state management |
| `types/` | TypeScript type definitions |
| `utils/` | Utility functions and helpers |

### Key Directories Explained

**routes/** - Remix uses file-based routing. Each file becomes a route:
- `_index.tsx` → `/` (homepage)
- `browse-data.datasets.tsx` → `/browse-data/datasets`
- `datasets.$id.tsx` → `/datasets/:id` (dynamic route)
- `api.*.ts` → API endpoints

**components/** - Organized by feature/page:
- `Layout/` - Header, footer, page layouts
- `BrowseData/` - Browse page components
- `Dataset/`, `Deposition/`, `Run/` - Detail page components
- `Filters/` - Filter UI components
- `Download/` - Download modal and related components

**graphql/** - Server-side queries fetched in route loaders:
```
graphql/
├── getDatasetByIdV2.server.ts
├── getDatasetsV2.server.ts
├── common.ts                  # Shared fragments
└── ...
```

**state/** - Jotai atoms for cross-component state:
- `annotation.ts` - Annotation viewing state
- `filterHistory.ts` - Filter history tracking
- `metadataDrawerTomogram.ts` - Drawer state

## Configuration Files

| File | Purpose |
|------|---------|
| `package.json` | Dependencies, scripts, and package metadata |
| `tsconfig.json` | TypeScript compiler options (strict mode enabled) |
| `remix.config.js` | Remix framework settings and server bundling |
| `tailwind.config.ts` | Custom Tailwind utilities and design tokens |
| `codegen.ts` | GraphQL code generation from API schema |
| `jest.config.cjs` | Jest test runner configuration |
| `playwright.config.ts` | E2E test browser and retry settings |

## Public Assets

```
public/
├── locales/en/
│   └── translation.json      # i18n translation strings
├── images/                   # Static images (PNG, SVG)
├── fonts/                    # Custom font files
└── favicon.png
```

Translation keys follow a hierarchical structure: `page.section.key`

## Generated Files

These directories are auto-generated and git-ignored:

| Directory | Generated By |
|-----------|--------------|
| `app/__generated_v2__/` | `pnpm data-portal build:codegen` (GraphQL types) |
| `build/` | `pnpm build` (Remix server build) |
| `public/build/` | `pnpm build` (client assets) |
| `.cache/` | Remix build cache |

> **Important**: Never edit files in `__generated_v2__/`. They are regenerated from the GraphQL schema on every codegen run.

## Component Organization Pattern

Components follow a consistent structure:

```
components/
└── ComponentName/
    ├── ComponentName.tsx         # Main component
    ├── ComponentName.module.css  # Scoped styles (CSS Modules)
    └── ComponentName.test.tsx    # Unit tests (optional)
```

## Next Steps

Continue to [Development Workflow](./04-development-workflow.md) to learn the daily commands and processes for working with this codebase.
